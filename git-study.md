title: Git Study

---

# Git Study
### Git Introduction

Git是一种开源的分布式版本管理系统。

每台安装了Git的机器上都会维持一个Git的本地仓库。

### 本地版本库的创建与管理

#### 创建与文件提交

- 初始化一个Git仓库：`git init`；
- 添加文件到Git仓库（[背后的原理](#gitadd-principle)）:
  1. `git add <file>` ，可以使用多次，添加多个文件；
  2. `git commit -m "提交说明文字"` ，完成一次提交。

#### 查看仓库状态

- `git status` ，查看本地仓库的[工作区](#workplace)状态，命令会告诉我们，当前有哪些文件被修改了，现在的状态是”没有添加任何文件“OR”已添加待提交“，此外还会对后续操作提示相应的命令；
- `git diff` ， 如果有文件被修改了，可以用该命令查看具体的修改内容（有"-"号的一行说明有删减，有“+”的一行说明有增加）。

#### 版本回退与回退的撤销

- `git log` ，查看提交的历史记录，以便确定回退到哪一个版本，精简输出可以使用`git log --pretty=oneline`；<span id="versionback"></span>

- `git reflog` ，查看命令的历史记录，可以用于确定版本回退之前的最新版本号`commit_id` ；

- `git reset --hard <commit_id>` ，`commit_id` 是版本号，是SHA1计算得出的十六进制数字，每提交一次就会新生成一个`commit_id` ，版本号没有必要每次都输入完整，保证前几位不同就可以。此外，`HEAD` 表示当前版本号，`HEAD^` 表示上一个版本号，以此类推，`HEAD~100` 表示上100个版本号。

  **注意** ：对于只有一个版本的版本库是无法再回退到上一个状态（即最初初始化的状态）

#### 工作区与暂存区

- <span id="workplace">工作区（Working Directory）</span>

  也就是当时使用`git init` 初始化的本地仓库的目录/文件夹。

- 版本库（Repository）

  工作区内的隐藏目录`.git` ，这个目录不算工作区，而是属于版本库。版本库中最重要的部分是暂存区（stage/index）这也是Git与SVN不同之处，同时还有Git自动创建的第一个[分支](#branch)`master` 和指向`master` 的[指针`HEAD`](#pointer-HEAD) 。

- 工作区与暂存区的关系

  这里通过`git add <file>` 的<span id="gitadd-principle">工作原理</span>来解释一下工作区与暂存区之间的关系。

  1. `git add` 添加的时候，实际上是将文件或者文件的修改添加到暂存区中；

  2. `git commit` 提交文件或文件修改，实际上是将暂存区的所有内容提交到当前分支中。

     **注意**：

     - 提交之后，工作区就没有任何新的修改，暂存区也没有任何内容，同时产生了新的版本。

     - 提交的时候，Git只负责将已经加入暂存区的修改内容提交到分支中，即若`git add` 之后再对文件进行修改，那么此时修改的内容是不会提交到分支中的。

       `git diff HEAD -- <file>` ，可以用于查看工作区与版本库中最新版本之间的区别。

#### 管理与修改、删除

Git跟踪并管理的是**文件的修改部分** ,而非整个文件。

所以，如果修改没有从工作区添加到暂存区，那么这些修改就无法被提交到版本库的最新版本中。

- `git checkout -- <file>` ，直接放弃对工作区的所有修改，这比一行一行的恢复更省力气，有时候对于不知道修改了哪部分内容的情况也很有用。

- `git rm --cached <file>` ，将添加到暂存区的修改撤销（unstage），并将修改重新放回工作区，如果此时仍想撤销所有的修改，则执行命令`git checkout -- <file>` ；

- 如果已经向本地版本库提交了不合适的修改并想要撤销时，需要[版本回退](#versionback)操作，前提是还没有推送到远程仓库。

- 若要删除一个文件，需要在工作区和版本库中同时删除该文件 `git rm <file>` ，并在删除完成后重新提交`git commit -m <file> ` 一次：

- 若在工作区错删了文件，则可以借助版本库，将该文件恢复到最新一次提交的状态：`git checkout -- <file>` *（当然，如果回收站还没清空的话，也可以去回收站看看）*；

- **注** ：`git checkout` 的原理是，利用版本库中的最新版本替换工作区的版本。


### 远程仓库

可以自己搭建Git服务器作为远程仓库，也可以使用Github的免费仓库（但是是公开的所有人可见的）。

一台电脑上也可以建立多个版本库，只要不在同一目录中即可。

Git支持SSH协议。

#### 添加远程库与推送Push

在完成Github注册和SSH Key添加之后，就可以在Github上创建一个新的Git仓库，然后根据相应的提示，将本地仓库的文件推送（Push）到远程仓库中。

- `git remote add origin <仓库地址>` ，在本地仓库目录下执行，将本地仓库与远程仓库进行关联，同时为远程仓库定义了新的名字`origin` ，当然也可以使用别的名字；
- `git push -u origin master` ，将本地仓库的内容推送到远成仓库，实际上是将当前分支`master` 的内容推送到远程仓库的`master` 分支，由于刚开始远程仓库是空的，所以第一次推送的时候，需要参数`-u` ，这样在推送的同时，还会建立起本地分支`master` 和远程仓库中`master` 分支的联系，以后推送和拉取内容就可以简化命令，即`git push origin master` 和

#### 从远程库克隆Clone

- `git clone https://github.com/zouguijin/docSync.git` 

- `git clone git@github.com:zouguijin/docSync.git` 

  Git支持多种协议，默认的git（所使用的是ssh协议），此外还可以使用https协议（但是https协议有时候比较慢，而且每次推送都需要输入口令，使用ssh就不需要输入口令）。